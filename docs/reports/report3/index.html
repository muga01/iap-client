<!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>Fleet management system</title>
        <style>
</style>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item { list-style-type: none; } .task-list-item-checkbox { margin-left: -20px; vertical-align: middle; }
</style>
        
        <script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
        
    </head>
    <body class="vscode-body vscode-light">
        <h1 id="fleet-management-system">Fleet management system</h1>
<table>
<thead>
<tr>
<th>ℹ️</th>
<th>This documentation is available online <a href="https://sosnus.github.io/iap-client/">here</a>.</th>
</tr>
</thead>
<tbody></tbody>
</table>
<table>
<thead>
<tr>
<th>ℹ️</th>
<th>Navigate to <a href="#report-2---establish-the-business-context-sketch-the-system-architecture-select-technology">report 2</a>.</th>
</tr>
</thead>
<tbody></tbody>
</table>
<table>
<thead>
<tr>
<th>ℹ️</th>
<th>Navigate to <a href="#report-3---implementation-of-data-exchange-and-synchronization-headquartershq--officesbo">report 3</a>.</th>
</tr>
</thead>
<tbody></tbody>
</table>
<table>
<thead>
<tr>
<th>ℹ️</th>
<th>Navigate to <a href="#report-4---performance-analysis-summary-and-conclusions-of-the-project">report 4</a>.</th>
</tr>
</thead>
<tbody></tbody>
</table>
<h2 id="team">Team</h2>
<ul>
<li>Monika Rosa 239113</li>
<li>Godfrey Mghase 239195</li>
<li>Stanisław Puławski 239111</li>
<li>Wiktor Muraszko 239109</li>
</ul>
<h2 id="description">Description</h2>
<p>The main objective of this project is to create a IT System for managing car fleet for the company, which consists of a headquarter and few branch offices located in different cities (Lodz, Warsaw, Cracow). Our solution connects the information systems of company's headquarters and its branches and allows enterprise to manage their car fleet. We have prepared working Web Service and Flutter Android client.</p>
<h3 id="repositories"><strong>Repositories</strong></h3>
<ul>
<li>Backend Hq repository <a href="https://github.com/Wredter/IAP_project_1">here</a>.</li>
<li>Backend bo repository <a href="https://github.com/muga01/IAP_project_2">here</a>.</li>
<li>Frontend repository <a href="https://github.com/sosnus/apiconsument">here</a>.</li>
</ul>
<p>Documentation, scripts (and special frontend for 1st repo) <a href="https://github.com/sosnus/iap-client">here</a></p>
<h2 id="technology-stack">Technology stack</h2>
<ul>
<li>Database
<ul>
<li>MySQL <code>MySQL Server 8.0.23-1debian10</code></li>
</ul>
</li>
<li>Backend
<ul>
<li>Java Spring <code>Spring Boot (v2.4.3)</code></li>
</ul>
</li>
<li>Frontend
<ul>
<li>Flutter <code>Flutter 2.2.2</code>
<ul>
<li>Android <a href="https://img.shields.io/badge/Android-yes-green">Flutter Android</a></li>
<li>Web <a href="https://img.shields.io/badge/Web-yes-green">Flutter Web</a></li>
<li>Web container <a href="https://img.shields.io/badge/Web%20container-not%20yet-red">Flutter Web container</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="production-deployment">Production deployment</h3>
<h4 id="production-deployment-links">Production deployment links</h4>
<ul>
<li><a href="https://iap-warsaw-hq.azurewebsites.net/">HQ Warsaw office</a></li>
<li><a href="https://iap-lodz-bo.azurewebsites.net/">BO Lodz office</a></li>
<li><a href="https://iap-cracow-bo.azurewebsites.net/">BO Cracow office</a></li>
</ul>
<p>Backend containers are hosted on ASP (App Service Plan) with 28 other applications. ASP based on tier B2 and have: 3.5GB RAM and 2vCPU cores</p>
<p>Databases containers are hosted on Azure Virtual Machine with a lot of tthers containers and services. VM size: Standard B1ms 1vCPU, 2GB RAM. Containers are separated and are ready to migration.</p>
<h1 id="todo-new-diagram">TODO: new diagram</h1>
<p><img src="file:////Users/stanislawpulawski/data/github/sosnus/iap-client/docs/img/deployment-diagram.png" alt="DBeaver"></p>
<p>When developer build and push image, webhooks will deploy container at ASP.</p>
<pre><code class="language-bash"><div>docker login sosnuscontainers.azurecr.io
<span class="hljs-comment"># login: ********</span>
<span class="hljs-comment"># password: *********</span>

docker build -t sosnuscontainers.azurecr.io/iap-warsaw-hq .
docker push sosnuscontainers.azurecr.io/iap-warsaw-hq

docker build -t sosnuscontainers.azurecr.io/iap-lodz-bo .
docker push sosnuscontainers.azurecr.io/iap-lodz-bo

docker build -t sosnuscontainers.azurecr.io/iap-cracow-bo .
docker push sosnuscontainers.azurecr.io/iap-cracow-bo

</div></code></pre>
<h1 id="todo-new-backend-address">TODO: new backend address</h1>
<h1 id="report-1---feasibility-study-of-communication-between-systems">Report 1 - Feasibility study of communication between systems</h1>
<table>
<thead>
<tr>
<th>ℹ️</th>
<th>the purpose of the first report is presentation connection between database, backend and frontend applications</th>
</tr>
</thead>
<tbody></tbody>
</table>
<p>First, test deploy consist of 3 parts:</p>
<ul>
<li>MySQL database</li>
<li>Spring boot backend service</li>
<li>Flutter Android client</li>
</ul>
<h4 id="test-deployment">test deployment</h4>
<p>For communication test purpouse, database and backend was deployed on docker containers, on the same Virtual Machine. VM size: Standard B1ms 1vCPU, 2GB RAM</p>
<ul>
<li>Backend address <a href="http://s-vm.northeurope.cloudapp.azure.com:8081/">here</a></li>
<li>Database address <a href="http://s-vm.northeurope.cloudapp.azure.com:3306/">here</a></li>
</ul>
<p>Before container deployment, it is necessary to enable new firewall rules:</p>
<pre><code class="language-bash"><div>ufw allow 22
ufw allow 3306
ufw allow 8081
ufw reload
</div></code></pre>
<h2 id="database---deploy-and-test">Database - deploy and test</h2>
<p>For database deployment, we use simple bash script to run new docker container from Docker Hub</p>
<pre><code class="language-bash"><div>
docker run --name some-mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql

</div></code></pre>
<p>We create first sql schema for this project using <a href="http://dbdiagram.io">dbdiagram.io</a> tool. Probably we will have some changes here in the future. Online documentation for our schema is <a href="https://dbdiagram.io/d/6053d308ecb54e10c33c2951">here</a></p>
<p><img src="file:////Users/stanislawpulawski/data/github/sosnus/iap-client/docs/img/db-schema.png" alt="DBeaver"></p>
<p>Next we create new database users to enable easy synchronous access for the rest of the team members. It is important for future deployments, we need independent user for every backend instance. Here is how we created the users.</p>
<pre><code class="language-sql"><div><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">&#x27;moderator1&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> <span class="hljs-keyword">IDENTIFIED</span> <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;1234&#x27;</span>;
<span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">PRIVILEGES</span> <span class="hljs-keyword">ON</span> * . * <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;moderator1&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span>;
<span class="hljs-keyword">FLUSH</span> <span class="hljs-keyword">PRIVILEGES</span>;

</div></code></pre>
<p>Next we add dump data for testing using the script below.</p>
<pre><code class="language-sql"><div><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-string">`users`</span> (<span class="hljs-string">`id`</span>, <span class="hljs-string">`first_name`</span>, <span class="hljs-string">`middle_name`</span>, <span class="hljs-string">`surname`</span>, <span class="hljs-string">`pesel`</span>, <span class="hljs-string">`gender`</span>, <span class="hljs-string">`birth_date`</span>, <span class="hljs-string">`role`</span>, <span class="hljs-string">`office_id`</span>) <span class="hljs-keyword">VALUES</span>

(<span class="hljs-number">1020</span>, <span class="hljs-string">&#x27;Ruth&#x27;</span>, <span class="hljs-string">&#x27;Elion&#x27;</span>, <span class="hljs-string">&#x27;Musk&#x27;</span>, <span class="hljs-number">19021989</span>, <span class="hljs-string">&#x27;M&#x27;</span>, <span class="hljs-string">&#x27;2020-10-20&#x27;</span>, <span class="hljs-string">&#x27;admin&#x27;</span>, <span class="hljs-string">&#x27;23&#x27;</span>),
(<span class="hljs-number">1021</span>, <span class="hljs-string">&#x27;Monika&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;Rosa&#x27;</span>, <span class="hljs-number">19021989</span>, <span class="hljs-string">&#x27;F&#x27;</span>, <span class="hljs-string">&#x27;1997-04-20&#x27;</span>, <span class="hljs-string">&#x27;client&#x27;</span>, <span class="hljs-string">&#x27;24&#x27;</span>),
(<span class="hljs-number">1023</span>, <span class="hljs-string">&#x27;Stanley&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;Murashko&#x27;</span>, <span class="hljs-number">1902198</span>, <span class="hljs-string">&#x27;M&#x27;</span>, <span class="hljs-string">&#x27;1999-08-09&#x27;</span>, <span class="hljs-string">&#x27;client&#x27;</span>, <span class="hljs-string">&#x27;23&#x27;</span>),
(<span class="hljs-number">1024</span>, <span class="hljs-string">&#x27;Godfrey&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;Muga&#x27;</span>, <span class="hljs-number">1902198</span>, <span class="hljs-string">&#x27;M&#x27;</span>, <span class="hljs-string">&#x27;1999-08-10&#x27;</span>, <span class="hljs-string">&#x27;admin&#x27;</span>, <span class="hljs-string">&#x27;24&#x27;</span>);

<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-string">`cars`</span> (<span class="hljs-string">`worker_id`</span>, <span class="hljs-string">`plate_number`</span>, <span class="hljs-string">`license_number`</span>, <span class="hljs-string">`model`</span>) <span class="hljs-keyword">VALUES</span>
(<span class="hljs-number">1020</span>, <span class="hljs-string">&#x27;1520&#x27;</span>, <span class="hljs-string">&#x27;5060&#x27;</span>, <span class="hljs-string">&#x27;Toyota&#x27;</span>),
(<span class="hljs-number">1021</span>, <span class="hljs-string">&#x27;1521&#x27;</span>, <span class="hljs-string">&#x27;5061&#x27;</span>, <span class="hljs-string">&#x27;Nissan&#x27;</span>),
(<span class="hljs-number">1023</span>, <span class="hljs-string">&#x27;1522&#x27;</span>, <span class="hljs-string">&#x27;5062&#x27;</span>, <span class="hljs-string">&#x27;Hundai&#x27;</span>),
(<span class="hljs-number">1024</span>, <span class="hljs-string">&#x27;1523&#x27;</span>, <span class="hljs-string">&#x27;5063&#x27;</span>, <span class="hljs-string">&#x27;Toyota&#x27;</span>);

<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-string">`offices`</span> (<span class="hljs-string">`id`</span>, <span class="hljs-string">`city`</span>, <span class="hljs-string">`type`</span>) <span class="hljs-keyword">VALUES</span>
(<span class="hljs-number">23</span>, <span class="hljs-string">&#x27;Lodz&#x27;</span>, <span class="hljs-string">&#x27;HQ&#x27;</span>),
(<span class="hljs-number">24</span>, <span class="hljs-string">&#x27;Warsaw&#x27;</span>, <span class="hljs-string">&#x27;BO&#x27;</span>);

</div></code></pre>
<p>We test Our database deployment using DBeaver desktop app:
<img src="file:////Users/stanislawpulawski/data/github/sosnus/iap-client/docs/img/db-screen2.png" alt="DBeaver"></p>
<h2 id="backend---deploy-and-test">Backend - deploy and test</h2>
<p>To deploy backend application, we need build container from source code and run it, using commands below:</p>
<pre><code class="language-bash"><div>git <span class="hljs-built_in">clone</span> https://github.com/Wredter/IAP_project_1
<span class="hljs-built_in">cd</span> ./IAP_project_1
docker stop iap-back-container -t 1
docker rm iap-back-container
docker build --no-cache -t iap-back .
docker run -d -p 8081:80 --name=iap-back-container iap-back
</div></code></pre>
<p>Now we can test backend project, by send http get request on <code>/hello</code> endpoint. In Our case, we can see it on <a href="http://s-vm.northeurope.cloudapp.azure.com:8081/hello">address</a>`
<img src="file:////Users/stanislawpulawski/data/github/sosnus/iap-client/docs/img/back-hello.png" alt="back-hello"></p>
<p>On endpoint <code>/users</code> we can see list of <code>elements</code> from <code>users</code> collections
<img src="file:////Users/stanislawpulawski/data/github/sosnus/iap-client/docs/img/back-users-json.png" alt="back-users-json"></p>
<h2 id="frontend---test">Frontend - test</h2>
<p>For first project iteration, we need implement a few features in frontend application:</p>
<ul>
<li>Connection to API</li>
<li>Users model</li>
<li>User list view</li>
</ul>
<h3 id="connection-to-api">Connection to API</h3>
<p>Class <code>FleetService</code> contains access to backend API using <code>package:http/http.dart</code> library</p>
<h3 id="users">Users</h3>
<p>User class is very simple, and help us to present data from Users collection from backend. We add it for test purpose, in next iteration this class will be modified, and contain expanded constructors and other methods</p>
<pre><code class="language-dart"><div><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>{
  <span class="hljs-built_in">int</span> id;
  <span class="hljs-built_in">String</span> pesel;
  <span class="hljs-built_in">String</span> firstName;
  <span class="hljs-built_in">String</span> sureName;

  User({<span class="hljs-keyword">this</span>.id, <span class="hljs-keyword">this</span>.pesel, <span class="hljs-keyword">this</span>.firstName, <span class="hljs-keyword">this</span>.sureName});
}
</div></code></pre>
<h3 id="user-list-view">User list view</h3>
<p>Main part of view in this project is builder, which can dynamic add new elements to ListView collection</p>
<pre><code class="language-dart"><div>Builder(
        builder: (_) {
          <span class="hljs-keyword">if</span> (_isLoading) {
            <span class="hljs-keyword">return</span> Center(child: CircularProgressIndicator());
          }

          <span class="hljs-keyword">if</span> (_apiResponse.error) {
            <span class="hljs-keyword">return</span> Center(child: Text(_apiResponse.errorMessage));
          }

          <span class="hljs-keyword">return</span> ListView.separated(
            separatorBuilder: (_, __) =&gt;
                Divider(height: <span class="hljs-number">1</span>, color: Colors.green),
            itemBuilder: (_, index) {
              <span class="hljs-keyword">return</span> Dismissible(
                key: ValueKey(_apiResponse.data[index].id),
                direction: DismissDirection.startToEnd,
                onDismissed: (direction) {},
                confirmDismiss: (direction) <span class="hljs-keyword">async</span> {
                  <span class="hljs-keyword">final</span> result = <span class="hljs-keyword">await</span> showDialog(
                      context: context, builder: (_) =&gt; UserDelete());
                  <span class="hljs-built_in">print</span>(result);
                  <span class="hljs-keyword">return</span> result;
                },
                background: Container(
                  color: Colors.red,
                  padding: EdgeInsets.only(left: <span class="hljs-number">16</span>),
                  child: Align(
                    child: Icon(Icons.delete, color: Colors.white),
                    alignment: Alignment.centerLeft,
                  ),
                ),
                child: ListTile(
                    title: Text(
                      _apiResponse.data[index].sureName,
                      style: TextStyle(color: Theme.of(context).primaryColor),
                    ),
                    subtitle: Text(<span class="hljs-string">&#x27;PESEL: <span class="hljs-subst">${_apiResponse.data[index].pesel}</span>&#x27;</span>),
                    onTap: () {}),
              );
            },
            itemCount: _apiResponse.data.length,
          );
        },
      ),
</div></code></pre>
<p>Application get list of users using service <code>fleet_service</code>, convert it into list of <code>User</code> objects, and present it as <code>ListTile</code> widgets:
<img src="file:////Users/stanislawpulawski/data/github/sosnus/iap-client/docs/img/front-users-view.png" alt="front-users-view"></p>
<h2 id="references-and-sources-for-1st-report">references and sources for 1st report</h2>
<ul>
<li><a href="https://www.youtube.com/watch?v=M8zM48Jytv0">REST API in flutter</a></li>
<li><a href="https://flutter.dev/docs">Flutter documentation</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-create-a-new-user-and-grant-permissions-in-mysql">Create database users</a></li>
</ul>
<h1 id="report-2---establish-the-business-context-sketch-the-system-architecture-select-technology">Report 2 - Establish the business context, sketch the system architecture, select technology</h1>
<h2 id="system-actors">System actors</h2>
<ul>
<li>Headquarters Manager - Headquarters Manager represents a system role with the authorization to assign car to the branch office, update HQ car details.</li>
<li>Branch Office Manager - Branch Office Manager represents a system role with the authorization to fill out the request form for the car, assign car to a worker, update BO car details.</li>
</ul>
<h2 id="activity-diagram">Activity diagram</h2>
<p><img src="file:////Users/stanislawpulawski/data/github/sosnus/iap-client/docs/img/diagram-1-v2.png" alt="diagram-1"></p>
<h2 id="deployment-diagram">Deployment diagram</h2>
<p><img src="file:////Users/stanislawpulawski/data/github/sosnus/iap-client/docs/img/diagram-2-v2.svg" alt="diagram-2"></p>
<h2 id="description-of-use-cases">Description of use cases</h2>
<h3 id="1-fill-out-the-request-form-when-worker-needs-new-car">1. Fill out the request form (when worker needs new car)</h3>
<ul>
<li>Type: general</li>
<li>Users: Branch Office Manager</li>
<li>Initial conditions: Branch Office Manager confirmed their identity via login and password.</li>
<li>Typical step sequence:</li>
</ul>
<ol>
<li>Branch Office Manager chooses an option to fill out the request form.</li>
<li>BO Manager fills out the request form</li>
</ol>
<ul>
<li>Alternative sequence of steps:<br>
2a. Request form was filled incorrectly, BO Manager repeats filling process.
2b. Request form was filled incorrectly, BO Manager displays help video and repeats the process.</li>
<li>Final conditions: the request form has been successfully filled.</li>
</ul>
<h3 id="2-assign-free-car-to-branch">2. Assign free car (to branch)</h3>
<ul>
<li>Type: general</li>
<li>Users: Headquarters Manager</li>
<li>Initial conditions: Headquarters Manager confirmed their identity via login and password.</li>
<li>Typical step sequence:</li>
</ul>
<ol>
<li>Cache requests</li>
<li>The request validation</li>
<li>HQ Manager assigns free car</li>
<li>Update HQ car details</li>
<li>Send car details to BO</li>
</ol>
<ul>
<li>Alternative sequence of steps:
2a. The request is invalid (error message is sent to BO)<br>
3a. There is no free car (notification is sent to BO)</li>
<li>Final conditions: the free car has been assigned to BO</li>
</ul>
<h3 id="3-assign-car-to-a-worker">3. Assign car to a worker</h3>
<ul>
<li>Type: general</li>
<li>Users: Branch Office Manager</li>
<li>Initial conditions: Branch Office Manager confirmed their identity via login and password.</li>
<li>Typical step sequence:</li>
</ul>
<ol>
<li>Branch Office Manager assigns car to the worker.</li>
<li>BO car details are updated.</li>
</ol>
<ul>
<li>Final conditions: car is assigned to worker.</li>
</ul>
<h2 id="references-and-sources-for-2nd-report">References and sources for 2nd report</h2>
<ul>
<li>
<p><a href="http://www.agilemodeling.com/artifacts/deploymentDiagram.htm">UML deployment diagram guide</a></p>
</li>
<li>
<p><a href="http://www.agilemodeling.com/style/activityDiagram.htm">UML activity diagram</a></p>
</li>
<li>
<p><a href="http://www.agilemodeling.com/artifacts/deploymentDiagram.htm">http://www.agilemodeling.com/artifacts/deploymentDiagram.htm</a></p>
</li>
<li>
<p><a href="http://www.agilemodeling.com/style/activityDiagram.htm">http://www.agilemodeling.com/style/activityDiagram.htm</a></p>
</li>
</ul>
<h1 id="report-3---implementation-of-data-exchange-and-synchronization-headquartershq--officesbo">Report 3 - Implementation of data exchange and synchronization (headquarters(HQ) / offices(BO))</h1>
<p><img src="file:////Users/stanislawpulawski/data/github/sosnus/iap-client/docs/deployment-diagram-28-06-2021.png" alt="hqmodel"></p>
<h2 id="application---backend">Application - Backend</h2>
<h3 id="data-models">Data Models</h3>
<p>As of now the data models for headquarters and branch office look pretty similar except for the responses model which takes care of all the responses the hq have ever sent to the branch office and some columns entries at branch office model are meant for data synchronization purposes.</p>
<h4 id="hq-model">HQ Model</h4>
<p><img src="file:////Users/stanislawpulawski/data/github/sosnus/iap-client/docs/img/hqmodel.JPG" alt="hqmodel">
Below we paste a sample code for the HQ office entity as implemented in our application.</p>
<pre><code class="language-java"><div>
<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = &quot;offices&quot;)</span>
<span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-meta">@ToString</span>
<span class="hljs-meta">@Builder</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Office</span> </span>{
    <span class="hljs-meta">@Getter</span>
    <span class="hljs-meta">@Setter</span>
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@NotNull</span>
    <span class="hljs-meta">@Column(name = &quot;id&quot;)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> id;
     
    <span class="hljs-meta">@Getter</span>
    <span class="hljs-meta">@Setter</span>
    <span class="hljs-meta">@Column(name = &quot;city&quot;)</span>
    <span class="hljs-keyword">public</span> String city;

    <span class="hljs-meta">@Getter</span>
    <span class="hljs-meta">@Setter</span>
    <span class="hljs-meta">@Column(name = &quot;type&quot;)</span>
    <span class="hljs-keyword">public</span> String type;
    
    <span class="hljs-meta">@Getter</span>
    <span class="hljs-meta">@Setter</span>
    <span class="hljs-meta">@Column(name = &quot;address&quot;)</span>
    <span class="hljs-keyword">public</span> String address;
}

</div></code></pre>
<h3 id="bo-model">BO Model</h3>
<p><img src="file:////Users/stanislawpulawski/data/github/sosnus/iap-client/docs/img/bomodel.JPG" alt="bomodel">
Below we paste a sample code for the bo users entity as implemented in our application.</p>
<pre><code class="language-java"><div><span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = &quot;users&quot;)</span>
<span class="hljs-meta">@Builder</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-meta">@ToString</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>{
    <span class="hljs-meta">@Getter</span>
    <span class="hljs-meta">@Setter</span>
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@NotNull</span>
    <span class="hljs-meta">@Min(40000)</span>
    <span class="hljs-meta">@Max(60000)</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> id;
    

    <span class="hljs-meta">@Getter</span>
    <span class="hljs-meta">@Setter</span>
    <span class="hljs-meta">@Column(name = &quot;first_name&quot;)</span>
    <span class="hljs-keyword">private</span> String firstName;

    <span class="hljs-meta">@Getter</span>
    <span class="hljs-meta">@Setter</span>
    <span class="hljs-meta">@Column(name = &quot;middle_name&quot;)</span>
    <span class="hljs-keyword">private</span> String middleName;

    <span class="hljs-meta">@Getter</span>
    <span class="hljs-meta">@Setter</span>
    <span class="hljs-meta">@Column(name = &quot;surname&quot;)</span>
    <span class="hljs-keyword">private</span> String surname;

    <span class="hljs-meta">@Getter</span>
    <span class="hljs-meta">@Setter</span>
    <span class="hljs-meta">@Size(min = 10, max = 12)</span>
    <span class="hljs-meta">@Column(name = &quot;pesel&quot;)</span>
    <span class="hljs-keyword">private</span> String pesel;

    <span class="hljs-meta">@Getter</span>
    <span class="hljs-meta">@Setter</span>
    <span class="hljs-meta">@Column(name = &quot;gender&quot;)</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">char</span> gender;

    <span class="hljs-meta">@Getter</span>
    <span class="hljs-meta">@Setter</span>
    <span class="hljs-meta">@Temporal(TemporalType.DATE)</span>
    <span class="hljs-meta">@Column(name = &quot;birth_date&quot;)</span>
    <span class="hljs-keyword">private</span> Date birthDate;


    
    <span class="hljs-meta">@ManyToOne(fetch = FetchType.LAZY, optional = false)</span>
    <span class="hljs-meta">@JoinColumn(name = &quot;office_id&quot;, nullable = false, referencedColumnName = &quot;id&quot;)</span>
    <span class="hljs-keyword">private</span> Office officeId;
    
    <span class="hljs-meta">@Getter</span>
    <span class="hljs-meta">@Setter</span>
    <span class="hljs-meta">@ManyToOne(fetch = FetchType.LAZY, optional = false)</span>
    <span class="hljs-meta">@JoinColumn(name = &quot;role_id&quot;, nullable = false, referencedColumnName = &quot;id&quot;)</span>
    <span class="hljs-keyword">private</span> Role roleId;
    
    <span class="hljs-meta">@Getter</span>
    <span class="hljs-meta">@Setter</span>
    <span class="hljs-meta">@Column(name = &quot;sync&quot;)</span>
    <span class="hljs-keyword">private</span> Boolean sync;
    

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">User</span><span class="hljs-params">(String firstName, String middleName, String surname, String pesel, <span class="hljs-keyword">char</span> gender, Date birthDate,Role roleId,Office officeId)</span></span>{
        <span class="hljs-keyword">this</span>.firstName = firstName;
        <span class="hljs-keyword">this</span>.middleName = middleName;
        <span class="hljs-keyword">this</span>.surname = surname;
        <span class="hljs-keyword">this</span>.pesel = pesel;
        <span class="hljs-keyword">this</span>.gender = gender;
        <span class="hljs-keyword">this</span>.birthDate = birthDate;
        <span class="hljs-keyword">this</span>.roleId = roleId;
        <span class="hljs-keyword">this</span>.officeId = officeId;
    }
}

</div></code></pre>
<h3 id="implementation-of-data-exchange-and-synchronization">Implementation of data exchange and synchronization</h3>
<p>We use <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/client/RestTemplate.html">RestTemplate</a> class under org.springframework.web.client package to manage data exchange, and for synchronization, we use <a href="https://docs.spring.io/spring-framework/docs/3.2.x/spring-framework-reference/html/scheduling.html">TaskSchedular interfaces</a> in spring boot by enabling the scheduling at the main application and use @ annotation for each method/class we need to schedule.</p>
<p>Enabling Scheduling in spring boot main application, @EnableScheduling and @EnableSwagger2 for documentation.</p>
<pre><code class="language-java"><div><span class="hljs-keyword">package</span> com.IAP.car_exchange;

<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-meta">@EnableScheduling</span>
<span class="hljs-meta">@EnableSwagger2</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CarExchangeApplication</span> </span>{

	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
		SpringApplication.run(CarExchangeApplication.class, args);
	}
	
	<span class="hljs-function"><span class="hljs-keyword">public</span> Docket <span class="hljs-title">productApi</span><span class="hljs-params">()</span> </span>{
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Docket(DocumentationType.SWAGGER_2).select()
		    .apis(RequestHandlerSelectors.basePackage(<span class="hljs-string">&quot;com.IAP.car_exchange&quot;</span>)).build();
		   }

	<span class="hljs-meta">@GetMapping(&quot;/hello&quot;)</span>
	<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(value = &quot;name&quot;, defaultValue = &quot;World&quot;)</span> String name)</span> </span>{
		<span class="hljs-keyword">return</span> String.format(<span class="hljs-string">&quot;Hello %s!&quot;</span>, name);
	}

}

</div></code></pre>
<h4 id="data-exchange-and-synchronization-for-branch-office">Data exchange and synchronization for branch office</h4>
<p>Firstly, assuming the office, role and user have been commissioned already, A user will create a request, this request will be stored in a local branch database and the RestTemplate.postForObject() method will be invoked to transfer this request to headquarter office. Incase of any failure, scheduling/synchronization has been enabled in such a way that after every 10 seconds the failed requests will be retransmitted again. Entities like User,Office, and Request have beeen synchronized such that there is a copy of each of them at the HQ server/database.</p>
<p>a. Synchronization properties definition</p>
<pre><code class="language-java"><div><span class="hljs-keyword">package</span> com.IAP.car_exchange;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SynchronizationConfiguration</span> </span>{
	
	<span class="hljs-comment">// connection to HQ</span>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String uriToHq = <span class="hljs-string">&quot;http://s-vm.northeurope.cloudapp.azure.com:8081/request&quot;</span>;
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String uriToHqUser = <span class="hljs-string">&quot;http://s-vm.northeurope.cloudapp.azure.com:8081/user&quot;</span>;
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String uriToHqOffice = <span class="hljs-string">&quot;http://s-vm.northeurope.cloudapp.azure.com:8081/office&quot;</span>;

	<span class="hljs-comment">// connection from HQ</span>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String  uriFromHq = <span class="hljs-string">&quot;details&quot;</span>;
	
	<span class="hljs-comment">// delay sync timer in millisecond</span>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> delay = <span class="hljs-number">10000</span>;

}

</div></code></pre>
<p>b. Synchronization service controller</p>
<pre><code class="language-java"><div><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SyncronizationController</span> </span>{
	
	
	<span class="hljs-meta">@Autowired</span>
	SyncronizationService syncronizationService;
	<span class="hljs-meta">@Autowired</span>
	SynchronizeUserService synchronizeUserService;
	<span class="hljs-meta">@Autowired</span>
	SynchronizeOfficeService synchronizeOfficeService;
	
	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger logger = LoggerFactory.getLogger(SyncronizationController.class);
	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> DateTimeFormatter dateFormat = DateTimeFormatter.ofPattern(&quot;HH:mm:ss&quot;);

	
	<span class="hljs-meta">@Scheduled(fixedDelay=SynchronizationConfiguration.delay)</span>
	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">synchronizeRequests</span><span class="hljs-params">()</span> </span>{
		logger.info(<span class="hljs-string">&quot;Scheduled Synchronization Task for requests :: Execution Time - {}&quot;</span>,dateFormat.format(LocalDateTime.now()));
		<span class="hljs-keyword">try</span> {
			ResponseEntity&lt;String&gt; sync = syncronizationService.tryToSync();
		} <span class="hljs-keyword">catch</span>(Exception ex) {
			logger.error(<span class="hljs-string">&quot;We have run into an error: we will reconnect shortly&quot;</span>);
		}
	}
	
	<span class="hljs-meta">@Scheduled(fixedDelay=SynchronizationConfiguration.delay)</span>
	<span class="hljs-keyword">public</span> <span class="hljs-meta">@ResponseBody</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">synchronizeUsers</span><span class="hljs-params">()</span> </span>{
		logger.info(<span class="hljs-string">&quot;Scheduled Synchronization Task for users :: Execution Time - {}&quot;</span>,dateFormat.format(LocalDateTime.now()));
		
		  <span class="hljs-keyword">try</span> { ResponseEntity&lt;String&gt; sync = synchronizeUserService.syncUsers(); }
		  <span class="hljs-keyword">catch</span>(Exception ex) {
		  logger.error(<span class="hljs-string">&quot;We have run into an error: we will reconnect shortly&quot;</span>); 
		  <span class="hljs-keyword">throw</span> ex; 
		  }		
	}
	
	<span class="hljs-meta">@Scheduled(fixedDelay=SynchronizationConfiguration.delay)</span>
	<span class="hljs-keyword">public</span> <span class="hljs-meta">@ResponseBody</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">synchronizeOffices</span><span class="hljs-params">()</span> </span>{
		logger.info(<span class="hljs-string">&quot;Scheduled Synchronization Task for Offices :: Execution Time - {}&quot;</span>,dateFormat.format(LocalDateTime.now()));
		
		  <span class="hljs-keyword">try</span> { ResponseEntity&lt;String&gt; sync = synchronizeOfficeService.syncOffices(); }
		  <span class="hljs-keyword">catch</span>(Exception ex) {
		  logger.error(<span class="hljs-string">&quot;We have run into an error: we will reconnect shortly&quot;</span>); 
		  <span class="hljs-keyword">throw</span> ex; 
		  }		
	}

}

</div></code></pre>
<p>c. Sychronization service implementation for requests as an example.</p>
<pre><code class="language-java"><div><span class="hljs-meta">@Repository</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SyncronizationService</span> </span>{
	<span class="hljs-keyword">final</span> RequestRepository requestRepository;
	
	RequestData requestData = <span class="hljs-keyword">new</span> RequestData();
	
	  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SyncronizationService</span><span class="hljs-params">(RequestRepository requestRepository)</span> </span>{
	  <span class="hljs-keyword">this</span>.requestRepository = requestRepository; }
	 
	
	<span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Request&gt; <span class="hljs-title">getAllUnsycedRequests</span><span class="hljs-params">()</span></span>{
		
		<span class="hljs-keyword">return</span> requestRepository.getAllUnyced();
	}
	
	<span class="hljs-function"><span class="hljs-keyword">public</span> ResponseEntity&lt;String&gt; <span class="hljs-title">tryToSync</span><span class="hljs-params">()</span></span>{
		
		
		<span class="hljs-comment">/*
		 * List&lt;Request&gt; requests = syncronizationService.getAllUnsycedRequests();
		 * if(requests.isEmpty()) { System.out.println(&quot;am empty &quot;+requests); }
		 */</span>
		List&lt;Request&gt; requests = getAllUnsycedRequests();
		<span class="hljs-keyword">if</span> (requests.isEmpty() == <span class="hljs-keyword">false</span>) {
			<span class="hljs-keyword">for</span>(Request r:requests) {
				<span class="hljs-comment">//System.out.println(r.getRequestorId());</span>
				
				<span class="hljs-comment">// Prepare the data to be sent to HQ for this request</span>

				requestData.setRequestorId(r.getRequestorId().getId());
				requestData.setBranchId(r.getBranchId());
				requestData.setCarModel(r.getCarModel());
				requestData.setVehiclePreffered(r.getVehiclePreffered());
				requestData.setRequestDate(r.getRequestDate());
				requestData.setRequestId(r.getRequestId());
				
				<span class="hljs-comment">// Now send it</span>
				<span class="hljs-comment">//String uri = &quot;http://localhost:8080/request&quot;;</span>
				RestTemplate restTemplate = <span class="hljs-keyword">new</span> RestTemplate();
				<span class="hljs-keyword">try</span> {
				RequestData result = restTemplate.postForObject(SynchronizationConfiguration.uriToHq,requestData, RequestData.class);
				} <span class="hljs-keyword">catch</span>(Exception e) {	
					System.out.println(&quot;We are sorry something happened we will <span class="hljs-keyword">try</span> again later!&quot;);
					//System.out.println(requestData.getRequestorId());
					//e.printStackTrace();
					<span class="hljs-keyword">throw</span> e;	
				}
				
				<span class="hljs-comment">// If success, change the sync status</span>
				r.setStatus(<span class="hljs-keyword">true</span>);
				requestRepository.save(r);
			}
		}

		<span class="hljs-keyword">return</span> ResponseEntity.ok(<span class="hljs-keyword">null</span>);
	}

}

</div></code></pre>
<h4 id="data-exchange-and-synchronization-for-head-quarter-office">Data exchange and synchronization for head quarter office</h4>
<p>Here, we transfer and synchnronize all the responses we have ever sent to the branch office. After we receive the car request from the branch office, we log it into the requests table and then the headquarter manager can check the pending requests, find the requested car by filtering, copy the requestid and just hit assign button and the car assignment process will proceed. Under the hood, if the car is found it's detail is packed and sent to the branch office and the necessary updates in the hq table entities is performed. If not found then the rejection notification is appended on the response. Again, the neccessary fields are updated to tell that this particular request has been processed and it is rejected.</p>
<h5 id="background-services">Background services</h5>
<p>a. Sychronization properties definition</p>
<pre><code class="language-java"><div><span class="hljs-keyword">package</span> com.IAP.car_exchange;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SynchronizationConfiguration</span> </span>{
	
	<span class="hljs-comment">// connection to BO</span>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String uriToBo = <span class="hljs-string">&quot;http://s-vm.northeurope.cloudapp.azure.com:8826/details&quot;</span>;
	
	<span class="hljs-comment">// connection from BO</span>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String  uriFromBo = <span class="hljs-string">&quot;request&quot;</span>;
	
	<span class="hljs-comment">// delay sync timer in millisecond</span>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> delay = <span class="hljs-number">5000</span>;

}

</div></code></pre>
<p>b. Responses synchronization controller</p>
<pre><code class="language-java"><div><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ResponsesSyncController</span> </span>{
	<span class="hljs-meta">@Autowired</span>
	ResponsesSycService responsesSycService;
	
	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger logger = LoggerFactory.getLogger(ResponsesSyncController .class);
	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> DateTimeFormatter dateFormat = DateTimeFormatter.ofPattern(&quot;HH:mm:ss&quot;);
	
	
	<span class="hljs-meta">@Scheduled(fixedDelay=SynchronizationConfiguration.delay)</span>
	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">synchronizeResponses</span><span class="hljs-params">()</span> </span>{
		logger.info(<span class="hljs-string">&quot;Scheduled Synchronization Task :: Execution Time - {}&quot;</span>,dateFormat.format(LocalDateTime.now()));
		<span class="hljs-keyword">try</span> {
			ResponseEntity&lt;String&gt; sync = responsesSycService.tryToSync();
		} <span class="hljs-keyword">catch</span>(Exception ex) {
			logger.error(<span class="hljs-string">&quot;We have run into an error: we will reconnect shortly&quot;</span>);
		}
	}

}

</div></code></pre>
<p>c. Responses synchronization service</p>
<pre><code class="language-java"><div><span class="hljs-meta">@Repository</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ResponsesSycService</span> </span>{
	
	<span class="hljs-keyword">final</span> ResponsesRepository responsesRepository;
	
	Response response = <span class="hljs-keyword">new</span> Response();
	
	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ResponsesSycService</span><span class="hljs-params">(ResponsesRepository responsesRepository)</span> </span>{
		<span class="hljs-keyword">this</span>.responsesRepository = responsesRepository;
	}
	
	<span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Responses&gt; <span class="hljs-title">getAllUnsycedResponses</span><span class="hljs-params">()</span></span>{
		
		<span class="hljs-keyword">return</span> responsesRepository.getAllUnsyc();
	}
	
	
	<span class="hljs-function"><span class="hljs-keyword">public</span> ResponseEntity&lt;String&gt; <span class="hljs-title">tryToSync</span><span class="hljs-params">()</span></span>{
		
		List&lt;Responses&gt; responses = getAllUnsycedResponses();
		<span class="hljs-keyword">if</span> (responses.isEmpty() == <span class="hljs-keyword">false</span>) {
			<span class="hljs-keyword">for</span>(Responses r:responses) {
				<span class="hljs-comment">// Prepare the data to be sent to HQ for this request</span>
				response.setWorkerId(r.getWorkerId());
				response.setPlateNumber(r.getPlateNumber());
				response.setLicenseNumber(r.getLicenseNumber());
				response.setModel(r.getModel());
				response.setType(r.getType());
				response.setVinNumber(r.getVinNumber());
				response.setRequestId(r.getRequestId());
				response.setRequestStatus(r.getRequestStatus());
				response.setApprovedBy(r.getApprovedBy());
				response.setApprovedDate(r.getApprovedDate());
				
				<span class="hljs-comment">// Now send it</span>
	
				RestTemplate restTemplate = <span class="hljs-keyword">new</span> RestTemplate();
			<span class="hljs-keyword">try</span> {
			Response result = restTemplate.postForObject(SynchronizationConfiguration.uriToBo,response, Response.class);
			} <span class="hljs-keyword">catch</span>(Exception e) {	
				System.out.println(&quot;We are sorry something happened we will <span class="hljs-keyword">try</span> again later! &quot;+e);
					<span class="hljs-keyword">throw</span> e;	
				}
				
				<span class="hljs-comment">// If success, change the sync status</span>
				r.setSent(<span class="hljs-keyword">true</span>);
				responsesRepository.save(r);
			}
		}

		<span class="hljs-keyword">return</span> ResponseEntity.ok(<span class="hljs-keyword">null</span>);
	}

}

</div></code></pre>
<h5 id="service-layer-descriptions">Service layer descriptions</h5>
<p>Here, we explain how we implemented the car request service. We should note that, CRUD operations have also been implemented for all the data models. Follow along the following steps:-</p>
<ol>
<li>
<p>A bo user create a request -- Data access layer</p>
<pre><code class="language-java"><div><span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RequestData</span> </span>{
   Long requestId;
   Long requestorId;
   Long branchId;
   String carModel;
   String vehiclePreffered;
   Date requestDate;
   String requestStatus;
   String approvedBy;
   Date approvedDate;
   String assignedCar;
   Boolean status;
}

</div></code></pre>
<p>Data access interface - the repository</p>
<pre><code class="language-java"><div><span class="hljs-keyword">package</span> com.IAP.car_exchange.repository;

<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;
<span class="hljs-keyword">import</span> org.springframework.data.jpa.repository.Query;

<span class="hljs-keyword">import</span> com.IAP.car_exchange.Model.Request;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">RequestRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">Request</span>,<span class="hljs-title">Long</span>&gt; </span>{
   <span class="hljs-meta">@Query(value = &quot;SELECT * FROM requests r ORDER BY r.request_id DESC LIMIT 1&quot;, nativeQuery = true)</span>
   <span class="hljs-function">Request <span class="hljs-title">getLastRecord</span><span class="hljs-params">()</span></span>;

   <span class="hljs-meta">@Query(&quot;SELECT r FROM Request r WHERE r.requestId=?1 AND r.assignedCar != null&quot;)</span>
   <span class="hljs-function">Request <span class="hljs-title">getUnassignedCar</span><span class="hljs-params">(Long requestId)</span></span>;

   <span class="hljs-meta">@Query(&quot;SELECT r FROM Request r WHERE r.status != true&quot;)</span>
   <span class="hljs-function">List&lt;Request&gt; <span class="hljs-title">getAllUnyced</span><span class="hljs-params">()</span></span>;
}

</div></code></pre>
</li>
<li>
<p>The request is stored in the database --- service layer</p>
<p>A request controller</p>
<pre><code class="language-java"><div><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RequestController</span> </span>{
   <span class="hljs-meta">@Autowired</span>
   Querries DataAccess;

   <span class="hljs-meta">@PostMapping(&quot;request&quot;)</span>
   <span class="hljs-meta">@JsonIgnoreProperties({&quot;hibernateLazyInitializer&quot;, &quot;handler&quot;})</span>
    <span class="hljs-keyword">public</span> <span class="hljs-meta">@ResponseBody</span>
    <span class="hljs-function">ResponseEntity&lt;String&gt; <span class="hljs-title">createRequest</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> RequestData dataHolder)</span></span>{

      <span class="hljs-comment">// Log this Request Locally</span>
        Request request = DataAccess.addRequest(
            dataHolder.getRequestorId(),
            dataHolder.getBranchId(),
            dataHolder.getCarModel(),
            dataHolder.getVehiclePreffered(),
            <span class="hljs-comment">//dataHolder.getRequestDate()</span>
            <span class="hljs-keyword">new</span> Date()
            );       

        <span class="hljs-keyword">return</span> ResponseEntity.ok(<span class="hljs-keyword">null</span>);
    }

   <span class="hljs-meta">@GetMapping(&quot;requests&quot;)</span>
   <span class="hljs-keyword">public</span> <span class="hljs-meta">@ResponseBody</span> <span class="hljs-function">Iterable&lt;Request&gt; <span class="hljs-title">getRequests</span><span class="hljs-params">()</span></span>{
      <span class="hljs-keyword">return</span> DataAccess.getAllRequests();
   }

    <span class="hljs-meta">@GetMapping(&quot;request/{id}&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Request <span class="hljs-title">getRequest</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span></span>{
        <span class="hljs-keyword">return</span> DataAccess.getRequestById(id);
    }

    <span class="hljs-meta">@DeleteMapping(&quot;_request/{id}&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ResponseEntity&lt;String&gt; <span class="hljs-title">deleteRequest</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long id)</span></span>{
        DataAccess.deleteRequest(id);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(<span class="hljs-string">&quot;Removed&quot;</span>);
    }

}
 
</div></code></pre>
<p>A request service method for adding a request only</p>
<pre><code class="language-java"><div>   <span class="hljs-function"><span class="hljs-keyword">public</span> Request <span class="hljs-title">addRequest</span><span class="hljs-params">(Long requestorId,Long branchId,String carModel,
 		String vehiclePreffered,Date requestDate)</span> </span>{
     User user = userRepository.findById(requestorId)
             .orElseThrow(() -&gt; <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">&quot;Invalid requestor Id: &quot;</span> + requestorId));
     Office office = officeRepository.findById(branchId)
             .orElseThrow(() -&gt; <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">&quot;Invalid branch Id: &quot;</span> + branchId));
 	Request request = Request.builder()
 			.requestorId(user)
 			.branchId(branchId)
 			.carModel(carModel)
 			.vehiclePreffered(vehiclePreffered)
 			.requestDate(requestDate)
 			.status(<span class="hljs-keyword">false</span>)
 			.build();
 	requestRepository.save(request);
 	<span class="hljs-keyword">return</span> request;
 }

</div></code></pre>
<p>If successfully, the requests is transfered to the hq for further processes.</p>
</li>
<li>
<p>The hq manager will manage the requests, via the AssignCarController service</p>
<pre><code class="language-java"><div><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AssignCarController</span> </span>{

 <span class="hljs-meta">@Autowired</span>
 Querries DataAccess;
 
 <span class="hljs-meta">@GetMapping(&quot;pendingrequests&quot;)</span>
 <span class="hljs-keyword">public</span> <span class="hljs-meta">@ResponseBody</span> <span class="hljs-function">Iterable&lt;Request&gt; <span class="hljs-title">getPendingRequest</span><span class="hljs-params">()</span></span>{
 	<span class="hljs-keyword">return</span> DataAccess.getPendingRequests();
 }
 
 <span class="hljs-meta">@GetMapping(&quot;filter/{model}/{type}&quot;)</span>
 <span class="hljs-keyword">public</span> <span class="hljs-meta">@ResponseBody</span> <span class="hljs-function">Iterable&lt;Car&gt; <span class="hljs-title">getCarByFilter</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String model, <span class="hljs-meta">@PathVariable</span> String type)</span> </span>{
 	<span class="hljs-keyword">return</span> DataAccess.getCarByModelType(model, type);
 }
 
 <span class="hljs-meta">@PostMapping(&quot;assign/{requestId}&quot;)</span>
 	<span class="hljs-keyword">public</span> <span class="hljs-meta">@ResponseBody</span> 
 	<span class="hljs-function">ResponseEntity&lt;String&gt; <span class="hljs-title">assign</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long requestId)</span></span>{
 	Response response = DataAccess.assign(requestId);
 	<span class="hljs-keyword">return</span> ResponseEntity.ok(<span class="hljs-keyword">null</span>);
 	}

</div></code></pre>
<p>At the end, the synchronization service will take of the rest, including sending back the response once the request has been attended.</p>
</li>
</ol>
<h2 id="application---frontend">Application - Frontend</h2>
<p><img src="file:////Users/stanislawpulawski/data/github/sosnus/iap-client/docs/img/frontend-gif.gif" alt="Image"></p>
<p>Application was prepared for multiplatform usages. During tests, we use 3 deployment types:</p>
<ul>
<li>iOS application</li>
<li>Android application</li>
<li>Web application</li>
</ul>
<p>Application was prepared for different screen sizes and proportions (landscape, horizontal, browser window)</p>
<p><img src="file:////Users/stanislawpulawski/data/github/sosnus/iap-client/docs/img/frontend-multiplatform.png" alt="vImage"></p>
<p>Application can be used as Headquater or Branch office, and can automaticaly adapt to type of office (HQ/BO). Main color theme and operations depend on office type.</p>
<h3 id="differnt-office-types">Differnt office types</h3>
<p>At the beginning of application, user can select backend application, where he wants do activities. API client is prepared at the next screen (Page Login).</p>
<p>Moreover, at login login screen, we initialize the most important libraries.</p>
<pre><code class="language-dart"><div><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:apiconsument/data/servers.dart&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:apiconsument/page_menu.dart&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:provider/provider.dart&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;data/api_service.dart&#x27;</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MaterialAppHome</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">final</span> Server choosenServer;
  MaterialAppHome(<span class="hljs-keyword">this</span>.choosenServer);

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Provider(
      create: (_) =&gt; ApiService.create(choosenServer.address),
      dispose: (context, ApiService service) =&gt; service.client.dispose(),
      child: MaterialApp(
        theme: ThemeData.from(
          colorScheme: choosenServer.colorScheme,
        ),
        title: choosenServer.type + <span class="hljs-string">&#x27; &#x27;</span> + choosenServer.city,
        home: PageMenu(
          choosenServer: choosenServer,
        ),
      ),
    );
  }
}
</div></code></pre>
<p>Important libraries:</p>
<ul>
<li>Provider - library to manage communication between screens</li>
<li>Chopper (here called ApiService) - library for managing API service</li>
<li>Material - library with Material Design style widgets</li>
</ul>
<h3 id="dynamic-build">Dynamic build</h3>
<p>Some views are used to build both application (for example PageListRequestsCars - but this page has a lot of differences between different office types. First - if this is HQ, list can show only pending request, and if it is HQ, user have extra button &quot;Assign&quot; on this page)</p>
<pre><code class="language-dart"><div><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;dart:convert&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;data/api_service.dart&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;data/requestCar.dart&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;data/servers.dart&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:apiconsument/page_one_requestCar.dart&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:chopper/chopper.dart&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:provider/provider.dart&#x27;</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PageListRequestsCars</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">final</span> Server choosenServer;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> isPendings;

  <span class="hljs-keyword">const</span> PageListRequestsCars({
    Key? key,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.isPendings,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.choosenServer,
  }) : <span class="hljs-keyword">super</span>(key: key);

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Scaffold(
      appBar: AppBar(
        title: Text(<span class="hljs-string">&#x27;List: Requests Cars&#x27;</span> + (isPendings ? <span class="hljs-string">&#x27; Pendings&#x27;</span> : <span class="hljs-string">&#x27; &#x27;</span>)),
      ),
      body: _buildList(context),
      floatingActionButton: FloatingActionButton(
        onPressed: () {},
        child: <span class="hljs-keyword">const</span> Icon(Icons.add),
      ),
    );
  }

  FutureBuilder&lt;Response&gt; _buildList(BuildContext context) {
    <span class="hljs-keyword">return</span> FutureBuilder&lt;Response&gt;(
      future: isPendings
          ? Provider.of&lt;ApiService&gt;(context).requestsPendingsAll()
          : Provider.of&lt;ApiService&gt;(context).requestsAll(),
      builder: (context, snapshot) {
        <span class="hljs-keyword">if</span> (snapshot.connectionState == ConnectionState.done) {
          <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span> requestsCarsCollection =
              json.decode(snapshot.data!.bodyString);
          <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;RequestCar&gt; requestCar = [];
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> item <span class="hljs-keyword">in</span> requestsCarsCollection) {
            requestCar.add(RequestCar.fromJson(item));
          }
          <span class="hljs-keyword">if</span> (requestCar.length == <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">if</span> (isPendings) {
              <span class="hljs-keyword">return</span> ListView(
                children: [
                  Center(
                    child: Text(
                      <span class="hljs-string">&quot;No pendings requests!&quot;</span>,
                      style:
                          TextStyle(fontSize: <span class="hljs-number">30</span>, fontWeight: FontWeight.bold),
                    ),
                  ),
                ],
              );
            } <span class="hljs-keyword">else</span> {
              <span class="hljs-keyword">return</span> ListView(
                children: [
                  Center(
                    child: Text(
                      <span class="hljs-string">&quot;No requests!&quot;</span>,
                      style:
                          TextStyle(fontSize: <span class="hljs-number">30</span>, fontWeight: FontWeight.bold),
                    ),
                  ),
                ],
              );
            }
          }
          <span class="hljs-keyword">return</span> _buildRequestCarList(context, requestCar);
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">return</span> Center(
            child: CircularProgressIndicator(),
          );
        }
      },
    );
  }

  ListView _buildRequestCarList(BuildContext context, <span class="hljs-built_in">List</span>&lt;RequestCar&gt; posts) {
    <span class="hljs-keyword">return</span> ListView.builder(
      itemCount: posts.length,
      padding: EdgeInsets.all(<span class="hljs-number">8</span>),
      itemBuilder: (context, index) {
        <span class="hljs-keyword">return</span> InkWell(
          child: posts[index].showAsCard(),
          onTap: () =&gt;
              _navigateToRequestDetails(context, posts[index].requestId),
        );
      },
    );
  }

  _navigateToRequestDetails(BuildContext context, <span class="hljs-built_in">int</span> requestId) {
    Navigator.of(context).push(
      MaterialPageRoute(
        builder: (context) =&gt; PageOneRequesCar(
          choosenServer: choosenServer,
          requestId: requestId,
          isPending: isPendings,
        ),
      ),
    );
  }
}

</div></code></pre>
<h3 id="api-consumption">API consumption</h3>
<p>API is consumed using Chopper library. This library can generate class for http API using simple abstract class. &quot;To define a client, use the @ ChopperApi annotation on an abstract class that extends the ChopperService class.&quot; <a href="https://github.com/lejard-h/chopper/blob/master/getting-started.html">More information:</a>
As we see, service address is declared during initialization, so we can use one API instance to prepare a lot of API services.</p>
<h3 id="chopper-api-class-before-generate">Chopper API class before generate</h3>
<pre><code class="language-dart"><div><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:chopper/chopper.dart&#x27;</span>;

<span class="hljs-keyword">part</span> <span class="hljs-string">&#x27;api_service.chopper.dart&#x27;</span>;

<span class="hljs-meta">@ChopperApi</span>()
<span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApiService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ChopperService</span> </span>{
  <span class="hljs-meta">@Get</span>(path: <span class="hljs-string">&#x27;/user/{id}&#x27;</span>)
  Future&lt;Response&gt; userById(<span class="hljs-meta">@Path</span>(<span class="hljs-string">&#x27;id&#x27;</span>) <span class="hljs-built_in">int</span> id);

  <span class="hljs-meta">@Post</span>(path: <span class="hljs-string">&#x27;/assign/{requestCarId}&#x27;</span>)
  Future&lt;Response&gt; assignRequestCar(<span class="hljs-meta">@Path</span>(<span class="hljs-string">&#x27;requestCarId&#x27;</span>) <span class="hljs-built_in">int</span> requestCarId);

  <span class="hljs-meta">@Get</span>(path: <span class="hljs-string">&#x27;/users&#x27;</span>)
  Future&lt;Response&gt; usersAll();

  <span class="hljs-meta">@Get</span>(path: <span class="hljs-string">&#x27;/office/{id}&#x27;</span>)
  Future&lt;Response&gt; officeById(<span class="hljs-meta">@Path</span>(<span class="hljs-string">&#x27;id&#x27;</span>) <span class="hljs-built_in">int</span> id);

  <span class="hljs-meta">@Get</span>(path: <span class="hljs-string">&#x27;/offices&#x27;</span>)
  Future&lt;Response&gt; officeAll();

  <span class="hljs-meta">@Get</span>(path: <span class="hljs-string">&#x27;/requests&#x27;</span>)
  Future&lt;Response&gt; requestsAll();

  <span class="hljs-meta">@Post</span>(path: <span class="hljs-string">&#x27;/request&#x27;</span>)
  Future&lt;Response&gt; postNewRequestCar(<span class="hljs-meta">@Body</span>() <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; myRequest);

  <span class="hljs-meta">@Get</span>(path: <span class="hljs-string">&#x27;/pendingrequests&#x27;</span>)
  Future&lt;Response&gt; requestsPendingsAll();

  <span class="hljs-meta">@Get</span>(path: <span class="hljs-string">&#x27;/request/{id}&#x27;</span>)
  Future&lt;Response&gt; requestById(<span class="hljs-meta">@Path</span>(<span class="hljs-string">&#x27;id&#x27;</span>) <span class="hljs-built_in">int</span> id);

  <span class="hljs-meta">@Get</span>(path: <span class="hljs-string">&#x27;/car/{plateNumber}&#x27;</span>)
  Future&lt;Response&gt; carByPlateNumber(<span class="hljs-meta">@Path</span>(<span class="hljs-string">&#x27;plateNumber&#x27;</span>) <span class="hljs-built_in">String</span> plateNumber);

  <span class="hljs-meta">@Delete</span>(path: <span class="hljs-string">&#x27;/_car/{plateNumber}&#x27;</span>)
  Future&lt;Response&gt; deleteCarByPlateNumber(
      <span class="hljs-meta">@Path</span>(<span class="hljs-string">&#x27;plateNumber&#x27;</span>) <span class="hljs-built_in">String</span> plateNumber);

  <span class="hljs-meta">@Delete</span>(path: <span class="hljs-string">&#x27;/_user/{userId}&#x27;</span>)
  Future&lt;Response&gt; deleteUserById(<span class="hljs-meta">@Path</span>(<span class="hljs-string">&#x27;userId&#x27;</span>) <span class="hljs-built_in">String</span> userId);

  <span class="hljs-meta">@Post</span>(path: <span class="hljs-string">&#x27;/user&#x27;</span>)
  Future&lt;Response&gt; postNewUser(<span class="hljs-meta">@Body</span>() <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; myUser);

  <span class="hljs-meta">@Get</span>(path: <span class="hljs-string">&#x27;/cars&#x27;</span>)
  Future&lt;Response&gt; carAll();

  <span class="hljs-meta">@Get</span>(path: <span class="hljs-string">&#x27;/posts&#x27;</span>)
  Future&lt;Response&gt; getPosts();

  <span class="hljs-meta">@Get</span>(path: <span class="hljs-string">&#x27;/posts/{id}&#x27;</span>)
  Future&lt;Response&gt; getPost(<span class="hljs-meta">@Path</span>(<span class="hljs-string">&#x27;id&#x27;</span>) <span class="hljs-built_in">int</span> id);

  <span class="hljs-meta">@Post</span>()
  Future&lt;Response&gt; postPost(
    <span class="hljs-meta">@Body</span>() <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; body,
  );

  <span class="hljs-keyword">static</span> ApiService create(<span class="hljs-built_in">String</span> address) {
    <span class="hljs-keyword">final</span> client = ChopperClient(
      baseUrl: address,
      services: [
        _$ApiService(),
      ],
      interceptors: [HttpLoggingInterceptor(), CurlInterceptor()],
      converter: JsonConverter(),
    );

    <span class="hljs-keyword">return</span> _$ApiService(client);
  }
}
</div></code></pre>
<p>To generate file, in console user must type <code>flutter packages pub run build_runner watch</code> - this command observed abstract API class and generate new class with endpoints at every file saved.</p>
<h3 id="chopper-api-class-after-generate">Chopper API class after generate</h3>
<pre><code class="language-dart"><div><span class="hljs-comment">// GENERATED CODE - DO NOT MODIFY BY HAND</span>

<span class="hljs-keyword">part</span> of <span class="hljs-string">&#x27;api_service.dart&#x27;</span>;

<span class="hljs-comment">// **************************************************************************</span>
<span class="hljs-comment">// ChopperGenerator</span>
<span class="hljs-comment">// **************************************************************************</span>

<span class="hljs-comment">// ignore_for_file: always_put_control_body_on_new_line, always_specify_types, prefer_const_declarations</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_</span>$<span class="hljs-title">ApiService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ApiService</span> </span>{
  _$ApiService([ChopperClient? client]) {
    <span class="hljs-keyword">if</span> (client == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">this</span>.client = client;
  }

  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">final</span> definitionType = ApiService;

  <span class="hljs-meta">@override</span>
  Future&lt;Response&lt;<span class="hljs-built_in">dynamic</span>&gt;&gt; userById(<span class="hljs-built_in">int</span> id) {
    <span class="hljs-keyword">final</span> $url = <span class="hljs-string">&#x27;/user/<span class="hljs-subst">$id</span>&#x27;</span>;
    <span class="hljs-keyword">final</span> $request = Request(<span class="hljs-string">&#x27;GET&#x27;</span>, $url, client.baseUrl);
    <span class="hljs-keyword">return</span> client.send&lt;<span class="hljs-built_in">dynamic</span>, <span class="hljs-built_in">dynamic</span>&gt;($request);
  }

  <span class="hljs-meta">@override</span>
  Future&lt;Response&lt;<span class="hljs-built_in">dynamic</span>&gt;&gt; assignRequestCar(<span class="hljs-built_in">int</span> requestCarId) {
    <span class="hljs-keyword">final</span> $url = <span class="hljs-string">&#x27;/assign/<span class="hljs-subst">$requestCarId</span>&#x27;</span>;
    <span class="hljs-keyword">final</span> $request = Request(<span class="hljs-string">&#x27;POST&#x27;</span>, $url, client.baseUrl);
    <span class="hljs-keyword">return</span> client.send&lt;<span class="hljs-built_in">dynamic</span>, <span class="hljs-built_in">dynamic</span>&gt;($request);
  }

  <span class="hljs-meta">@override</span>
  Future&lt;Response&lt;<span class="hljs-built_in">dynamic</span>&gt;&gt; usersAll() {
    <span class="hljs-keyword">final</span> $url = <span class="hljs-string">&#x27;/users&#x27;</span>;
    <span class="hljs-keyword">final</span> $request = Request(<span class="hljs-string">&#x27;GET&#x27;</span>, $url, client.baseUrl);
    <span class="hljs-keyword">return</span> client.send&lt;<span class="hljs-built_in">dynamic</span>, <span class="hljs-built_in">dynamic</span>&gt;($request);
  }

  <span class="hljs-meta">@override</span>
  Future&lt;Response&lt;<span class="hljs-built_in">dynamic</span>&gt;&gt; officeById(<span class="hljs-built_in">int</span> id) {
    <span class="hljs-keyword">final</span> $url = <span class="hljs-string">&#x27;/office/<span class="hljs-subst">$id</span>&#x27;</span>;
    <span class="hljs-keyword">final</span> $request = Request(<span class="hljs-string">&#x27;GET&#x27;</span>, $url, client.baseUrl);
    <span class="hljs-keyword">return</span> client.send&lt;<span class="hljs-built_in">dynamic</span>, <span class="hljs-built_in">dynamic</span>&gt;($request);
  }

  <span class="hljs-meta">@override</span>
  Future&lt;Response&lt;<span class="hljs-built_in">dynamic</span>&gt;&gt; officeAll() {
    <span class="hljs-keyword">final</span> $url = <span class="hljs-string">&#x27;/offices&#x27;</span>;
    <span class="hljs-keyword">final</span> $request = Request(<span class="hljs-string">&#x27;GET&#x27;</span>, $url, client.baseUrl);
    <span class="hljs-keyword">return</span> client.send&lt;<span class="hljs-built_in">dynamic</span>, <span class="hljs-built_in">dynamic</span>&gt;($request);
  }

  <span class="hljs-meta">@override</span>
  Future&lt;Response&lt;<span class="hljs-built_in">dynamic</span>&gt;&gt; requestsAll() {
    <span class="hljs-keyword">final</span> $url = <span class="hljs-string">&#x27;/requests&#x27;</span>;
    <span class="hljs-keyword">final</span> $request = Request(<span class="hljs-string">&#x27;GET&#x27;</span>, $url, client.baseUrl);
    <span class="hljs-keyword">return</span> client.send&lt;<span class="hljs-built_in">dynamic</span>, <span class="hljs-built_in">dynamic</span>&gt;($request);
  }

  <span class="hljs-meta">@override</span>
  Future&lt;Response&lt;<span class="hljs-built_in">dynamic</span>&gt;&gt; postNewRequestCar(<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; myRequest) {
    <span class="hljs-keyword">final</span> $url = <span class="hljs-string">&#x27;/request&#x27;</span>;
    <span class="hljs-keyword">final</span> $body = myRequest;
    <span class="hljs-keyword">final</span> $request = Request(<span class="hljs-string">&#x27;POST&#x27;</span>, $url, client.baseUrl, body: $body);
    <span class="hljs-keyword">return</span> client.send&lt;<span class="hljs-built_in">dynamic</span>, <span class="hljs-built_in">dynamic</span>&gt;($request);
  }

  <span class="hljs-meta">@override</span>
  Future&lt;Response&lt;<span class="hljs-built_in">dynamic</span>&gt;&gt; requestsPendingsAll() {
    <span class="hljs-keyword">final</span> $url = <span class="hljs-string">&#x27;/pendingrequests&#x27;</span>;
    <span class="hljs-keyword">final</span> $request = Request(<span class="hljs-string">&#x27;GET&#x27;</span>, $url, client.baseUrl);
    <span class="hljs-keyword">return</span> client.send&lt;<span class="hljs-built_in">dynamic</span>, <span class="hljs-built_in">dynamic</span>&gt;($request);
  }

  <span class="hljs-meta">@override</span>
  Future&lt;Response&lt;<span class="hljs-built_in">dynamic</span>&gt;&gt; requestById(<span class="hljs-built_in">int</span> id) {
    <span class="hljs-keyword">final</span> $url = <span class="hljs-string">&#x27;/request/<span class="hljs-subst">$id</span>&#x27;</span>;
    <span class="hljs-keyword">final</span> $request = Request(<span class="hljs-string">&#x27;GET&#x27;</span>, $url, client.baseUrl);
    <span class="hljs-keyword">return</span> client.send&lt;<span class="hljs-built_in">dynamic</span>, <span class="hljs-built_in">dynamic</span>&gt;($request);
  }

  <span class="hljs-meta">@override</span>
  Future&lt;Response&lt;<span class="hljs-built_in">dynamic</span>&gt;&gt; carByPlateNumber(<span class="hljs-built_in">String</span> plateNumber) {
    <span class="hljs-keyword">final</span> $url = <span class="hljs-string">&#x27;/car/<span class="hljs-subst">$plateNumber</span>&#x27;</span>;
    <span class="hljs-keyword">final</span> $request = Request(<span class="hljs-string">&#x27;GET&#x27;</span>, $url, client.baseUrl);
    <span class="hljs-keyword">return</span> client.send&lt;<span class="hljs-built_in">dynamic</span>, <span class="hljs-built_in">dynamic</span>&gt;($request);
  }

  <span class="hljs-meta">@override</span>
  Future&lt;Response&lt;<span class="hljs-built_in">dynamic</span>&gt;&gt; deleteCarByPlateNumber(<span class="hljs-built_in">String</span> plateNumber) {
    <span class="hljs-keyword">final</span> $url = <span class="hljs-string">&#x27;/_car/<span class="hljs-subst">$plateNumber</span>&#x27;</span>;
    <span class="hljs-keyword">final</span> $request = Request(<span class="hljs-string">&#x27;DELETE&#x27;</span>, $url, client.baseUrl);
    <span class="hljs-keyword">return</span> client.send&lt;<span class="hljs-built_in">dynamic</span>, <span class="hljs-built_in">dynamic</span>&gt;($request);
  }

  <span class="hljs-meta">@override</span>
  Future&lt;Response&lt;<span class="hljs-built_in">dynamic</span>&gt;&gt; deleteUserById(<span class="hljs-built_in">String</span> userId) {
    <span class="hljs-keyword">final</span> $url = <span class="hljs-string">&#x27;/_user/<span class="hljs-subst">$userId</span>&#x27;</span>;
    <span class="hljs-keyword">final</span> $request = Request(<span class="hljs-string">&#x27;DELETE&#x27;</span>, $url, client.baseUrl);
    <span class="hljs-keyword">return</span> client.send&lt;<span class="hljs-built_in">dynamic</span>, <span class="hljs-built_in">dynamic</span>&gt;($request);
  }

  <span class="hljs-meta">@override</span>
  Future&lt;Response&lt;<span class="hljs-built_in">dynamic</span>&gt;&gt; postNewUser(<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; myUser) {
    <span class="hljs-keyword">final</span> $url = <span class="hljs-string">&#x27;/user&#x27;</span>;
    <span class="hljs-keyword">final</span> $body = myUser;
    <span class="hljs-keyword">final</span> $request = Request(<span class="hljs-string">&#x27;POST&#x27;</span>, $url, client.baseUrl, body: $body);
    <span class="hljs-keyword">return</span> client.send&lt;<span class="hljs-built_in">dynamic</span>, <span class="hljs-built_in">dynamic</span>&gt;($request);
  }

  <span class="hljs-meta">@override</span>
  Future&lt;Response&lt;<span class="hljs-built_in">dynamic</span>&gt;&gt; carAll() {
    <span class="hljs-keyword">final</span> $url = <span class="hljs-string">&#x27;/cars&#x27;</span>;
    <span class="hljs-keyword">final</span> $request = Request(<span class="hljs-string">&#x27;GET&#x27;</span>, $url, client.baseUrl);
    <span class="hljs-keyword">return</span> client.send&lt;<span class="hljs-built_in">dynamic</span>, <span class="hljs-built_in">dynamic</span>&gt;($request);
  }

  <span class="hljs-meta">@override</span>
  Future&lt;Response&lt;<span class="hljs-built_in">dynamic</span>&gt;&gt; getPosts() {
    <span class="hljs-keyword">final</span> $url = <span class="hljs-string">&#x27;/posts&#x27;</span>;
    <span class="hljs-keyword">final</span> $request = Request(<span class="hljs-string">&#x27;GET&#x27;</span>, $url, client.baseUrl);
    <span class="hljs-keyword">return</span> client.send&lt;<span class="hljs-built_in">dynamic</span>, <span class="hljs-built_in">dynamic</span>&gt;($request);
  }

  <span class="hljs-meta">@override</span>
  Future&lt;Response&lt;<span class="hljs-built_in">dynamic</span>&gt;&gt; getPost(<span class="hljs-built_in">int</span> id) {
    <span class="hljs-keyword">final</span> $url = <span class="hljs-string">&#x27;/posts/<span class="hljs-subst">$id</span>&#x27;</span>;
    <span class="hljs-keyword">final</span> $request = Request(<span class="hljs-string">&#x27;GET&#x27;</span>, $url, client.baseUrl);
    <span class="hljs-keyword">return</span> client.send&lt;<span class="hljs-built_in">dynamic</span>, <span class="hljs-built_in">dynamic</span>&gt;($request);
  }

  <span class="hljs-meta">@override</span>
  Future&lt;Response&lt;<span class="hljs-built_in">dynamic</span>&gt;&gt; postPost(<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; body) {
    <span class="hljs-keyword">final</span> $url = <span class="hljs-string">&#x27;&#x27;</span>;
    <span class="hljs-keyword">final</span> $body = body;
    <span class="hljs-keyword">final</span> $request = Request(<span class="hljs-string">&#x27;POST&#x27;</span>, $url, client.baseUrl, body: $body);
    <span class="hljs-keyword">return</span> client.send&lt;<span class="hljs-built_in">dynamic</span>, <span class="hljs-built_in">dynamic</span>&gt;($request);
  }
}

</div></code></pre>
<h3 id="api-debugging">API debugging</h3>
<p>Library can show every used request as cURL request, it can help to debug or error reproduction. It is easy to compare request from Flutter with request from Postman (both tools have option export request to cURL)
<img src="file:////Users/stanislawpulawski/data/github/sosnus/iap-client/docs/img/frontend-curl.png" alt="vImage"></p>
<h3 id="new-page-new-request">New page, new request</h3>
<p>Requests are send when user open new page. When view is not ready, builder show Circular indicator. Application wait for respond or timeout.</p>
<pre><code class="language-dart"><div><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;data/api_service.dart&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;data/servers.dart&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;data/user.dart&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:chopper/chopper.dart&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:provider/provider.dart&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;page_add_offices.dart&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;page_menu.dart&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;page_list_users.dart&#x27;</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PageAfterAddUser</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">final</span> User user;
  <span class="hljs-keyword">final</span> Server choosenServer;

  <span class="hljs-keyword">const</span> PageAfterAddUser(
      {Key? key, <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.user, <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.choosenServer})
      : <span class="hljs-keyword">super</span>(key: key);

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Scaffold(
      appBar: AppBar(
        title: Text(<span class="hljs-string">&#x27;User added: &#x27;</span> + user.id.toString()),
      ),
      body: _buildList(context),
      floatingActionButton: FloatingActionButton(
        child: <span class="hljs-keyword">const</span> Icon(Icons.backpack_outlined),
        onPressed: () =&gt; _navigateToAddOffice(context),
      ),
    );
  }

  FutureBuilder&lt;Response&gt; _buildList(BuildContext context) {
    <span class="hljs-keyword">return</span> FutureBuilder&lt;Response&gt;(
      future: Provider.of&lt;ApiService&gt;(context).postNewUser(user.toJson()),
      builder: (context, snapshot) {
        <span class="hljs-keyword">if</span> (snapshot.connectionState == ConnectionState.done) {
          <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> myRespond = snapshot.data!.bodyString;
          <span class="hljs-keyword">return</span> _buildPosts(context, myRespond);
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">return</span> Center(
            child: CircularProgressIndicator(),
          );
        }
      },
    );
  }


Widget _buildPosts(BuildContext context, <span class="hljs-built_in">String</span> myRespond) {
...

<span class="hljs-keyword">void</span> _navigateToAddOffice(BuildContext context) {
...

</div></code></pre>
<h3 id="views-design---project">Views design - project</h3>
<p>First project was prepared in Figma application - tool to UI design.</p>
<p><img src="file:////Users/stanislawpulawski/data/github/sosnus/iap-client/docs/img/frontend-figma.png" alt="Image"></p>
<p>This table shows samples of views from figma and their Flutter implementations
(Violet - figma design, orange - Flutter implementation)</p>
<p><img src="file:////Users/stanislawpulawski/data/github/sosnus/iap-client/docs/img/front-figma-create-user.png" alt="view-1"> , <img src="file:////Users/stanislawpulawski/data/github/sosnus/iap-client/docs/img/front-add-user.png" alt="view-1">
<img src="file:////Users/stanislawpulawski/data/github/sosnus/iap-client/docs/img/view2.png" alt="view-2"> , <img src="file:////Users/stanislawpulawski/data/github/sosnus/iap-client/docs/img/front-requess-list.png" alt="view-2">
<img src="file:////Users/stanislawpulawski/data/github/sosnus/iap-client/docs/img/view3.png" alt="view-3"> , <img src="file:////Users/stanislawpulawski/data/github/sosnus/iap-client/docs/img/front-details.png" alt="view-3"></p>
<h3 id="flutter-dart-debug">Flutter, Dart, Debug</h3>
<p>Dart have a lot of tools (called DartDevTools) which can support develop process.</p>
<p><img src="file:////Users/stanislawpulawski/data/github/sosnus/iap-client/docs/img/frontend-debug.png" alt="vImage"></p>
<h3 id="resources">RESOURCES</h3>
<ol>
<li><a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/client/RestTemplate.html">REST Template for Data Exchange</a></li>
<li><a href="https://docs.spring.io/spring-framework/docs/3.2.x/spring-framework-reference/html/scheduling.html">Task Schedular interfaces for Data Synchronization</a></li>
<li><a href="https://www.baeldung.com/swagger-2-documentation-for-spring-rest-api">Setting Up Swagger 2 with a Spring REST API</a></li>
<li><a href="https://github.com/lejard-h/chopper/blob/master/getting-started.html">How does Chopper work?</a></li>
</ol>

    </body>
    </html>